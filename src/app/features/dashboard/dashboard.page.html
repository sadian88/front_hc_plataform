<section class="space-y-6">
  <header class="glass-card flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <p class="text-sm uppercase tracking-wide text-night-500">Panel operativo</p>
      <h1 class="text-3xl font-semibold text-night-100">Dashboard principal</h1>
      <p class="text-night-400">Métricas resumidas del estado de tus automatizaciones.</p>
    </div>
    <div class="flex items-center gap-3">
      <button class="rounded-2xl border border-night-700 px-4 py-2 text-sm text-night-100 hover:bg-night-900/60">
        Exportar
      </button>
      <button class="rounded-2xl bg-night-700 px-4 py-2 text-sm font-semibold text-night-100 hover:bg-night-600">
        Nueva alerta
      </button>
    </div>
  </header>

  <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
    <article
      *ngFor="let card of cards"
      class="metric-card rounded-3xl border border-night-800/80 bg-night-900/40 p-5 shadow-soft-card">
      <p class="text-sm text-night-500">{{ card.label }}</p>
      <p class="mt-2 text-3xl font-semibold text-night-100">{{ card.value }}</p>
      <p class="text-sm text-night-400">{{ card.change }}</p>
    </article>
  </div>

  <div class="grid gap-6 lg:grid-cols-[1.1fr_0.9fr]">
    <article class="glass-card space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-night-100">Leads recientes</h2>
        <span class="text-sm text-night-500">{{ recentLeads().length }} registros</span>
      </div>
      <div class="space-y-3" *ngIf="recentLeads().length; else emptyLeads">
        <div
          *ngFor="let lead of recentLeads(); trackBy: trackLead"
          class="flex items-center justify-between rounded-2xl border border-night-800/70 bg-night-900/40 px-4 py-3">
          <div>
            <p class="font-medium text-night-100">{{ lead.nombre || 'Sin nombre' }}</p>
            <p class="text-sm text-night-500">
              {{ lead.company_name || 'Sin compañía' }} · {{ lead.cargo || 'Sin cargo' }}
            </p>
          </div>
          <p class="text-sm text-night-400">
            {{ lead.updated_at ? (lead.updated_at | date: 'short') : 'Sin fecha' }}
          </p>
        </div>
      </div>
      <ng-template #emptyLeads>
        <p class="text-sm text-night-400">No hay leads registrados aún.</p>
      </ng-template>
    </article>

    <article class="glass-card space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-night-100">Top compañías por scraping</h2>
        <span class="text-sm text-night-500">{{ topCompanies().length }} compañías</span>
      </div>
      <div class="space-y-4" *ngIf="topCompanies().length; else emptyCompanies">
        <div
          *ngFor="let company of topCompanies(); trackBy: trackCompany"
          class="rounded-2xl border border-night-800/70 bg-night-900/40 p-4">
          <p class="text-sm text-night-500">ID {{ company.id }}</p>
          <p class="mt-1 text-2xl font-semibold text-night-100">{{ company.company_name }}</p>
          <p class="text-sm text-night-400">
            {{ company.search_results }} resultados detectados
          </p>
        </div>
      </div>
      <ng-template #emptyCompanies>
        <p class="text-sm text-night-400">Aún no hay resultados de scraping.</p>
      </ng-template>
    </article>
  </div>

  <article class="glass-card space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold text-night-100">Distribución</h2>
      <span class="text-sm text-night-500">Consolidado actual</span>
    </div>
    <div class="grid gap-6 lg:grid-cols-[1fr_1.2fr] items-center">
      <div class="chart-wrapper" *ngIf="leadChartData(); else emptyChart">
        <p-chart type="doughnut" [data]="leadChartData()"></p-chart>
      </div>
      <ng-template #emptyChart>
        <p class="text-sm text-night-400">Sin datos para graficar.</p>
      </ng-template>
      <div class="flex flex-col gap-4">
        <div class="insight-card">
          <p class="text-sm text-night-500">Leads vs resultados</p>
          <p class="text-2xl font-semibold text-night-100">
            {{ data()?.summary?.leads || 0 }} / {{ data()?.summary?.searchResults || 0 }}
          </p>
          <p class="text-sm text-night-400">Leads registrados y scrapings detectados.</p>
        </div>
        <div class="insight-card">
          <p class="text-sm text-night-500">Última actualización</p>
          <p class="text-lg font-semibold text-night-100">
            {{ data()?.summary?.latestLeadUpdate ? (data()?.summary?.latestLeadUpdate | date: 'mediumDate') : 'Sin dato' }}
          </p>
          <p class="text-sm text-night-400">Basado en los registros más recientes.</p>
        </div>
      </div>
    </div>
  </article>
</section>
