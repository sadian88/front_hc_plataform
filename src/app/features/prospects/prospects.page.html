<section class="space-y-8 pb-12">
  <header class="flex flex-wrap items-center justify-between gap-4 px-2">
    <div>
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">Lead Prospecto</h1>
      <p class="text-gray-500 font-medium">{{ statusMessage() }}</p>
    </div>
    <div class="flex gap-3">
      <button
        class="flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-50 transition-all shadow-sm"
        (click)="refresh()">
        <lucide-icon name="refresh-cw" class="size-4" [class.animate-spin]="loading()"></lucide-icon>
        Refrescar
      </button>
    </div>
  </header>

  <article class="glass-card">
    <div *ngIf="hasServerFilter()" class="server-filter-banner">
      <span>
        Filtrando por <strong>company_id</strong> = {{ sourceScrapingFilter() }}
      </span>
      <button type="button" class="text-sm font-semibold underline hover:text-hc-700"
        (click)="clearSourceScrapingFilter()">
        Ver todos
      </button>
    </div>

    <div class="table-controls mb-6">
      <div class="control-field grow">
        <label for="searchFilter">Criterio de búsqueda</label>
        <div class="relative">
          <input id="searchFilter" type="search" placeholder="Nombre, email, empresa..." [value]="searchTerm()"
            (input)="onSearchInput($event)" class="w-full pl-10" />
          <lucide-icon name="search"
            class="absolute left-3 top-1/2 -translate-y-1/2 size-4 text-gray-400"></lucide-icon>
        </div>
      </div>
      <div class="control-field">
        <label for="companyFilter">Empresa asignada</label>
        <select id="companyFilter" [value]="companyFilter()" (change)="onCompanyFilterChange($event)">
          <option value="">Todas las empresas</option>
          <option *ngFor="let company of companyOptions()" [value]="company">
            {{ company }}
          </option>
        </select>
      </div>
      <div class="control-field">
        <label for="estadoFilter">Estado</label>
        <select id="estadoFilter" [value]="estadoFilter()" (change)="onEstadoFilterChange($event)">
          <option value="">Cualquier estado</option>
          <option *ngFor="let estado of estadoOptions()" [value]="estado">
            {{ estado }}
          </option>
        </select>
      </div>
      <button type="button"
        class="flex items-center gap-2 px-4 py-2 text-sm font-semibold text-gray-600 hover:text-hc-600 disabled:opacity-30 transition-colors"
        (click)="clearFilters()" [disabled]="!hasActiveFilters()">
        <lucide-icon name="x" class="size-4"></lucide-icon>
        Limpiar
      </button>
    </div>

    <p-table #prospectsTable class="prospect-table" [value]="tableRows()" [loading]="loading()" [paginator]="true"
      [rows]="10" [rowsPerPageOptions]="[10, 20, 50]" [showCurrentPageReport]="true" responsiveLayout="scroll"
      [globalFilterFields]="['nombre_completo', 'email', 'cargo', 'assignedCompanyLabel', 'displayLocation', 'displayEstado']"
      dataKey="id">
      <ng-template pTemplate="header">
        <tr>
          <th>Lead Prospecto</th>
          <th>Contacto</th>
          <th>Ubicación</th>
          <th>Empresa Asignada</th>
          <th>Estado</th>
          <th>Fecha</th>
          <th class="actions-column">Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-prospect>
        <tr>
          <td>
            <div class="flex items-center gap-3">
              <div class="avatar-circle">
                <lucide-icon name="user" class="size-5"></lucide-icon>
              </div>
              <div class="flex flex-col">
                <span class="font-bold text-gray-900">{{ prospect.nombre_completo || 'Sin nombre' }}</span>
                <span class="text-xs text-gray-500 font-medium" *ngIf="prospect.cargo">{{ prospect.cargo }}</span>
              </div>
            </div>
          </td>
          <td>
            <div class="flex flex-col gap-1.5">
              <div class="flex items-center gap-2 text-sm text-gray-600" *ngIf="prospect.email">
                <lucide-icon name="mail" class="size-3 text-gray-400"></lucide-icon>
                <span>{{ prospect.email }}</span>
              </div>
              <a *ngIf="prospect.perfil_linkedin" [href]="prospect.perfil_linkedin" target="_blank"
                class="flex items-center gap-2 text-xs font-semibold text-blue-600 hover:underline">
                <lucide-icon name="linkedin" class="size-3"></lucide-icon>
                LinkedIn
              </a>
            </div>
          </td>
          <td>
            <div class="flex flex-col">
              <span class="text-sm text-gray-900">{{ prospect.displayLocation }}</span>
            </div>
          </td>
          <td>
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700">
              {{ prospect.assignedCompanyLabel || 'Sin asignar' }}
            </span>
          </td>
          <td>
            <span
              class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-bold uppercase tracking-wider bg-gray-100 text-gray-600">
              {{ prospect.displayEstado }}
            </span>
          </td>
          <td>
            <span class="text-xs text-gray-500">
              {{ prospect.updated_at ? (prospect.updated_at | date: 'dd MMM yyyy') : '---' }}
            </span>
          </td>
          <td class="actions-column">
            <div class="flex items-center justify-end gap-1">
              <button class="icon-btn" (click)="startEdit(prospect)" title="Editar">
                <lucide-icon name="pencil" class="size-4"></lucide-icon>
              </button>
              <button class="icon-btn icon-btn--danger" (click)="deleteProspect(prospect)" title="Eliminar">
                <lucide-icon name="trash" class="size-4"></lucide-icon>
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </article>
</section>